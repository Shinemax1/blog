<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>hustle</title>
    <meta name="description" content="keep going">
    <link rel="icon" href="/logo.jpg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.f31cb560.css" as="style"><link rel="preload" href="/assets/js/app.242f705e.js" as="script"><link rel="preload" href="/assets/js/15.36ec339b.js" as="script"><link rel="prefetch" href="/assets/js/21.1cf38461.js"><link rel="prefetch" href="/assets/js/2.798e7f11.js"><link rel="prefetch" href="/assets/js/3.a551541a.js"><link rel="prefetch" href="/assets/js/4.33b7e257.js"><link rel="prefetch" href="/assets/js/5.9aca0c97.js"><link rel="prefetch" href="/assets/js/6.2d25dfd7.js"><link rel="prefetch" href="/assets/js/7.99377039.js"><link rel="prefetch" href="/assets/js/8.7300fa69.js"><link rel="prefetch" href="/assets/js/9.4c135ec7.js"><link rel="prefetch" href="/assets/js/10.b2e0b132.js"><link rel="prefetch" href="/assets/js/11.8e520bde.js"><link rel="prefetch" href="/assets/js/12.1529996b.js"><link rel="prefetch" href="/assets/js/13.1a99e3af.js"><link rel="prefetch" href="/assets/js/14.cfc00b50.js"><link rel="prefetch" href="/assets/js/16.88d4d223.js"><link rel="prefetch" href="/assets/js/17.068ae501.js"><link rel="prefetch" href="/assets/js/18.341504f8.js"><link rel="prefetch" href="/assets/js/19.076ff65d.js"><link rel="prefetch" href="/assets/js/20.78cd1a83.js"><link rel="prefetch" href="/assets/js/22.21f66cd4.js"><link rel="prefetch" href="/assets/js/23.be34c602.js"><link rel="prefetch" href="/assets/js/24.b9a2cfd8.js"><link rel="prefetch" href="/assets/js/25.5f3432a0.js"><link rel="prefetch" href="/assets/js/26.d8ea2f94.js"><link rel="prefetch" href="/assets/js/27.83b00011.js"><link rel="prefetch" href="/assets/js/28.63241875.js"><link rel="prefetch" href="/assets/js/29.d27ee75c.js"><link rel="prefetch" href="/assets/js/30.7f11141f.js"><link rel="prefetch" href="/assets/js/31.70209c42.js"><link rel="prefetch" href="/assets/js/32.7623353d.js"><link rel="prefetch" href="/assets/js/33.ba555a32.js"><link rel="prefetch" href="/assets/js/34.161da363.js"><link rel="prefetch" href="/assets/js/35.5ceaea76.js"><link rel="prefetch" href="/assets/js/36.1f678a99.js"><link rel="prefetch" href="/assets/js/37.9de9c6be.js"><link rel="prefetch" href="/assets/js/38.35747815.js"><link rel="prefetch" href="/assets/js/39.c6a2638d.js"><link rel="prefetch" href="/assets/js/40.d174ab8c.js"><link rel="prefetch" href="/assets/js/41.2d767136.js"><link rel="prefetch" href="/assets/js/42.53869fe9.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.960fbd11.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f31cb560.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">hustle</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/front/" class="nav-link router-link-active">front</a></div><div class="nav-item"><a href="/en/algorithm/" class="nav-link">algorithm</a></div><div class="nav-item"><a href="/en/operations/" class="nav-link">operations</a></div><div class="nav-item"><a href="/en/CS/" class="nav-link">CS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>plan</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/plan/daily/" class="nav-link">Daily plan</a></li><li class="dropdown-subitem"><a href="/en/plan/week/" class="nav-link">Week plan</a></li><li class="dropdown-subitem"><a href="/en/plan/monthly/" class="nav-link">Monthly plan</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/front/Browser/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/front/Browser/" class="nav-link">简体中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/front/" class="nav-link router-link-active">front</a></div><div class="nav-item"><a href="/en/algorithm/" class="nav-link">algorithm</a></div><div class="nav-item"><a href="/en/operations/" class="nav-link">operations</a></div><div class="nav-item"><a href="/en/CS/" class="nav-link">CS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>plan</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/plan/daily/" class="nav-link">Daily plan</a></li><li class="dropdown-subitem"><a href="/en/plan/week/" class="nav-link">Week plan</a></li><li class="dropdown-subitem"><a href="/en/plan/monthly/" class="nav-link">Monthly plan</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/front/Browser/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/front/Browser/" class="nav-link">简体中文</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>front</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/en/front/" class="sidebar-link">JS</a></li><li><a href="/en/front/Browser/" class="active sidebar-link">Browser</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/front/Browser/#the-three-phases-of-event-propagation" class="sidebar-link">The three phases of event propagation</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#event-registration" class="sidebar-link">Event Registration</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#event-delegation" class="sidebar-link">Event Delegation</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#cors" class="sidebar-link">CORS</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#document-domain" class="sidebar-link">document.domain</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#postmessage" class="sidebar-link">postMessage</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#event-loop-in-node" class="sidebar-link">Event Loop in Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/front/Browser/#timer" class="sidebar-link">timer</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#pending-callbacks" class="sidebar-link">pending callbacks</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#idle-prepare" class="sidebar-link">idle, prepare</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#poll" class="sidebar-link">poll</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#check" class="sidebar-link">check</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#close-callbacks" class="sidebar-link">close callbacks</a></li></ul></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#cookie，localstorage，sessionstorage，indexdb" class="sidebar-link">cookie，localStorage，sessionStorage，indexDB</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#service-worker" class="sidebar-link">Service Worker</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#difference-between-load-domcontentloaded" class="sidebar-link">Difference between Load &amp; DOMContentLoaded</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#layers" class="sidebar-link">Layers</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#repaint-reflow" class="sidebar-link">Repaint &amp; Reflow</a></li><li class="sidebar-sub-header"><a href="/en/front/Browser/#minimize-repaint-reflow" class="sidebar-link">Minimize Repaint &amp; Reflow</a></li></ul></li><li><a href="/en/front/Framework/" class="sidebar-link">Framework</a></li><li><a href="/en/front/MP/" class="sidebar-link">MP</a></li><li><a href="/en/front/Performance/" class="sidebar-link">Performance</a></li><li><a href="/en/front/React/" class="sidebar-link">React</a></li><li><a href="/en/front/Safety/" class="sidebar-link">Safety</a></li><li><a href="/en/front/Vue/" class="sidebar-link">Vue</a></li><li><a href="/en/front/Ali/" class="sidebar-link">Ali</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p><strong>Table of Contents</strong> <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener noreferrer">DocToc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p> <ul><li><a href="#event-mechanism">Event mechanism</a> <ul><li><a href="#the-three-phases-of-event-propagation">The three phases of event propagation</a></li> <li><a href="#event-registration">Event Registration</a></li> <li><a href="#event-delegation">Event Delegation</a></li></ul></li> <li><a href="#cross-domain">Cross Domain</a> <ul><li><a href="#jsonp">JSONP</a></li> <li><a href="#cors">CORS</a></li> <li><a href="#documentdomain">document.domain</a></li> <li><a href="#postmessage">postMessage</a></li></ul></li> <li><a href="#event-loop">Event Loop</a> <ul><li><a href="#event-loop-in-node">Event Loop in Node</a> <ul><li><a href="#timer">timer</a></li> <li><a href="#pending-callbacks">pending callbacks</a></li> <li><a href="#idle-prepare">idle, prepare</a></li> <li><a href="#poll">poll</a></li> <li><a href="#check">check</a></li> <li><a href="#close-callbacks">close callbacks</a></li></ul></li></ul></li> <li><a href="#storage">Storage</a> <ul><li><a href="#cookielocalstoragesessionstorageindexdb">cookie，localStorage，sessionStorage，indexDB</a></li> <li><a href="#service-worker">Service Worker</a></li></ul></li> <li><a href="#rendering-mechanism">Rendering mechanism</a> <ul><li><a href="#difference-between-load--domcontentloaded">Difference between Load &amp; DOMContentLoaded</a></li> <li><a href="#layers">Layers</a></li> <li><a href="#repaint--reflow">Repaint &amp; Reflow</a></li> <li><a href="#minimize-repaint--reflow">Minimize Repaint &amp; Reflow</a></li></ul></li></ul> <h1 id="event-mechanism"><a href="#event-mechanism" aria-hidden="true" class="header-anchor">#</a> Event mechanism</h1> <h2 id="the-three-phases-of-event-propagation"><a href="#the-three-phases-of-event-propagation" aria-hidden="true" class="header-anchor">#</a> The three phases of event propagation</h2> <p>Event propagation has three phases:</p> <ul><li>The event object propagates from the Window to the target’s parent. Capturing events will trigger.</li> <li>The event object arrives at the event object’s event target. Events registered to target will trigger.</li> <li>The event object propagates from the target's parent up to the Window. Bubbling events will trigger.</li></ul> <p>Event propagation generally follows the above sequence, but there are exceptions. If a target node is registered for both bubbling and capturing events, events are invoked in the order they were registered.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// The following code will print bubbling first and then trigger capture events</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bubble'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'capture'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="event-registration"><a href="#event-registration" aria-hidden="true" class="header-anchor">#</a> Event Registration</h2> <p>Usually, we use <code>addEventListener</code> to register an event, and the <code>useCapture</code> is a function parameter, which receives a Boolean value, the default value is <code>false</code>. <code>useCapture</code> determines whether the registered event is a capturing event or a bubbling event. For the object parameter, you can use the following properties:</p> <ul><li><code>capture</code>, Boolean value, same as <code>useCapture</code></li> <li><code>once</code>, Boolean value, <code>true</code> indicating that the callback should be called at most once, after invoked the listener will be removed</li> <li><code>passive</code>, Boolean, means it will never call <code>preventDefault</code></li></ul> <p>Generally speaking, we only want the event to trigger on the target. To achieve this we can use <code>stopPropagation</code> to prevent the propagation of the event. Usually, we would think that <code>stopPropagation</code> is used to stop the event bubbling, but this function can also prevent the event capturing. <code>stopImmediatePropagation</code> can achieve the same effects, and it can also prevent other listeners of the same event from being called.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	event<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bubbling'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Clicking node will only execute the above function, this function will not execute</span>
node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'capture '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="event-delegation"><a href="#event-delegation" aria-hidden="true" class="header-anchor">#</a> Event Delegation</h2> <p>If a child node inside a parent node is dynamically generated, events on the child node should be added to parent node:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ul<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
	<span class="token keyword">let</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#ul'</span><span class="token punctuation">)</span>
	ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Event delegation has the following advantages over adding events straight to child nodes:</p> <ul><li>Save memory</li> <li>No need remove event listeners on child nodes</li></ul> <h1 id="cross-domain"><a href="#cross-domain" aria-hidden="true" class="header-anchor">#</a> Cross Domain</h1> <p>Browsers have the same-origin policy for security reasons. In other words, if the protocol, domain name or port has one difference, that would be cross-domain, and the Ajax request will fail.</p> <p>We can solve the cross-domain issues through following methods:</p> <h2 id="jsonp"><a href="#jsonp" aria-hidden="true" class="header-anchor">#</a> JSONP</h2> <p>The principle of JSONP is very simple, that is to make use of the <code>&lt;script&gt;</code> tag not subject to same-origin policy. Use the <code>src</code> attribute of <code>&lt;script&gt;</code> tag and provide a callback function to receive data:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;http://domain/api?param1=a&amp;param2=b&amp;callback=jsonp&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>JSONP is simple to use and has good compatibility, but is limited to <code>get</code> requests.</p> <p>You may encounter the situation where you have the same callback names in multiple JSONP requests. In this situation you need to encapsulate JSONP. The following is a simple implementation:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> jsonpCallback<span class="token punctuation">,</span> success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">;</span>
  window<span class="token punctuation">[</span>jsonpCallback<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span>
  <span class="token string">&quot;http://xxx&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;callback&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="cors"><a href="#cors" aria-hidden="true" class="header-anchor">#</a> CORS</h2> <p>CORS requires browser and backend support at the same time. Internet Explorer 8 and 9 expose CORS via the XDomainRequest object.</p> <p>The browser will automatically perform CORS. The key to implementing CORS is the backend. As long as the backend implements CORS, it enables cross-domain.</p> <p>The server sets <code>Access-Control-Allow-Origin</code> to enable CORS. This property specifies which domains can access the resource. If set to wildcard, all websites can access the resource.</p> <h2 id="document-domain"><a href="#document-domain" aria-hidden="true" class="header-anchor">#</a> document.domain</h2> <p>This can only be used for the same second-level domain, for example, <code>a.test.com</code> and <code>b.test.com</code> are suitable for this case.</p> <p>Set <code>document.domain = 'test.com'</code> would enable CORS within the same second-level domain.</p> <h2 id="postmessage"><a href="#postmessage" aria-hidden="true" class="header-anchor">#</a> postMessage</h2> <p>This method is usually used to get data from embedded third-party page. One page sends a message, the other page checks the source and receives the message:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// send of page</span>
window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// receive of page</span>
<span class="token keyword">var</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mc<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> origin <span class="token operator">=</span> event<span class="token punctuation">.</span>origin <span class="token operator">||</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>origin <span class="token operator">===</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="event-loop"><a href="#event-loop" aria-hidden="true" class="header-anchor">#</a> Event Loop</h1> <p>As we all know, JS is a non-blocking and single-threaded language, because JS was born to interact with the browser in the beginning. If JS was a multi-threaded language, we might have problems handling DOM in multiple threads (imagine adding nodes in a thread and deleting nodes in another thread at the same time), however we could introduce a read-write lock to solve this problem.</p> <p>Execution context, generated during JS execution, will be pushed into call stack sequentially. Asynchronous codes will hang up and get pushed into the task queues (there are multiple kinds of tasks). Once the call stack is empty, the Event Loop will process the next message in the task queues and push it into the call stack for execution, thus essentially the asynchronous operation in JS is actually synchronous.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The above code is asynchronous, even though the <code>setTimeout</code> delay is 0. That’s because the HTML5 standard stipulates that the second parameter of the function  <code>setTimeout</code> must not be less than 4 milliseconds, otherwise it will automatically .  So <code>setTimeout</code> is still logged after <code>script end</code>.</p> <p>Different tasks are assigned to different Task queues. Tasks can be divided into <code>microtasks</code> and <code>macrotasks</code>. In the ES6 specification, a <code>microtask</code> is called a <code>job</code> and a <code>macrotask</code> is called a <code>task</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// script start =&gt; Promise =&gt; script end =&gt; promise1 =&gt; promise2 =&gt; setTimeout</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Although <code>setTimeout</code> is set before <code>Promise</code>, the above printing still occurs because <code>Promise</code> belongs to microtask and <code>setTimeout</code> belongs to macrotask.</p> <p>Microtasks include <code>process.nextTick</code>, <code>promise</code>, <code>Object.observe</code> and <code>MutationObserver</code>.</p> <p>Macrotasks include <code>script</code>, <code>setTimeout</code>, <code>setInterval</code>, <code>setImmediate</code>, <code>I/O</code> and <code>UI rendering</code>.</p> <p>Many people have the misunderstanding that microtasks always get executed before macrotasks and this is incorrect. Because the macrotask includes <code>script</code>, the browser will perform this macrotask first, followed by any microtasks in asynchronous codes.</p> <p>So the correct sequence of an event loop looks like this:</p> <ol><li>Execute synchronous codes, which belongs to macrotask</li> <li>Once call stack is empty, query if any microtasks need to be executed</li> <li>Execute all the microtasks</li> <li>If necessary, render the UI</li> <li>Then start the next round of the Event loop, and execute the asynchronous operations in the macrotask</li></ol> <p>According to the above sequence of the event loop, if the asynchronous codes in the macrotask have a large number of calculations and need to operate on DOM, we can put DOM operation into microtask for faster interface response.</p> <h2 id="event-loop-in-node"><a href="#event-loop-in-node" aria-hidden="true" class="header-anchor">#</a> Event Loop in Node</h2> <p>The event loop in Node is not the same as in the browser.</p> <p>The event loop in Node is divided into 6 phases, and they will be executed in order repeatedly:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>   ┌───────────────────────┐
┌─&gt;│        timers         │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     pending callbacks │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     idle, prepare     │
│  └──────────┬────────────┘      ┌───────────────┐
│  ┌──────────┴────────────┐      │   incoming:   │
│  │         poll          │&lt;──---|   connections │
│  └──────────┬────────────┘      │   data, etc.  │
│  ┌──────────┴────────────┐      └───────────────┘
│  │        check          │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
└──┤    close callbacks    │
   └───────────────────────┘
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="timer"><a href="#timer" aria-hidden="true" class="header-anchor">#</a> timer</h3> <p>The <code>timer</code> phase executes the callbacks of <code>setTimeout</code> and <code>setInterval</code>.</p> <p><code>Timer</code> specifies the time that callbacks will run as early as they can be scheduled, after the specified amount of time has passed rather than the exact time a person wants it to be executed.</p> <p>The lower bound time has a range: <code>[1, 2147483647]</code>. If the set time is not in this range, it will be set to 1.</p> <h3 id="pending-callbacks"><a href="#pending-callbacks" aria-hidden="true" class="header-anchor">#</a> pending callbacks</h3> <p>This phase executes I/O callbacks deferred to the next loop iteration.</p> <h3 id="idle-prepare"><a href="#idle-prepare" aria-hidden="true" class="header-anchor">#</a> idle, prepare</h3> <p>The <code>idle, prepare</code> phase is for internal implementation.</p> <h3 id="poll"><a href="#poll" aria-hidden="true" class="header-anchor">#</a> poll</h3> <p>This phase retrieves new I/O events; execute I/O related callbacks (almost all with the exception of close callbacks, the ones scheduled by timers, and setImmediate()); node will block here when appropriate.</p> <p>The <code>poll</code> phase has two main functions:</p> <ol><li>Calculating how long it should block and poll for I/O, then</li> <li>Processing events in the poll queue.</li></ol> <p>When the event loop enters the <code>poll</code> phase and there are no timers scheduled, one of two things will happen:</p> <ul><li>If the <code>poll</code> queue is not empty, the event loop will iterate through its queue of callbacks executing them synchronously until either the queue has been exhausted, or the system-dependent hard limit is reached.</li> <li>If the <code>poll</code> queue is empty, one of two more things will happen:
<ol><li>If scripts have been scheduled by <code>setImmediate</code>. the event loop will end the <code>poll</code> phase and continue to the check phase to execute those scheduled scripts.</li> <li>If scripts have not been scheduled by <code>setImmediate</code>, the event loop will wait for callbacks to be added to the queue, then execute them immediately.</li></ol></li></ul> <p>Once the <code>poll</code> queue is empty the event loop will check for timers whose time thresholds have been reached. If one or more timers are ready, the event loop will wrap back to the timers phase to execute those timers' callbacks.</p> <h3 id="check"><a href="#check" aria-hidden="true" class="header-anchor">#</a> check</h3> <p>The <code>check</code> phase executes the callbacks of <code>setImmediate</code>.</p> <h3 id="close-callbacks"><a href="#close-callbacks" aria-hidden="true" class="header-anchor">#</a> close callbacks</h3> <p>The <code>close</code> event will be emitted in this phase.</p> <p>And in Node, the order of execution of timers is random in some cases:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Here, it may log setTimeout =&gt; setImmediate</span>
<span class="token comment">// It is also possible to log the opposite result, which depends on performance</span>
<span class="token comment">// Because it may take less than 1 millisecond to enter the event loop, `setImmediate` would be executed at this time.</span>
<span class="token comment">// Otherwise it will execute `setTimeout`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Certainly, in this case, the execution order is the same:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Because the callback of `readFile` was executed in `poll` phase</span>
<span class="token comment">// Founding `setImmediate`,it immediately jumps to the `check` phase to execute the callback</span>
<span class="token comment">// and then goes to the `timer` phase to execute `setTimeout`</span>
<span class="token comment">// so the above output must be `setImmediate` =&gt; `setTimeout`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The above is the implementation of the macrotask. The microtask will be executed immediately after each phase is completed.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>

    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>

    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">// The log result is different, when the above code is executed in browser and node</span>
<span class="token comment">// In browser, it will log: timer1 =&gt; promise1 =&gt; timer2 =&gt; promise2</span>
<span class="token comment">// In node, it may log: timer1 =&gt; timer2 =&gt; promise1 =&gt; promise2</span>
<span class="token comment">// or timer1, promise1, timer2, promise2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>process.nextTick</code> in Node will be executed before other microtasks.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;timer1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;nextTick&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// nextTick =&gt; timer1 =&gt; promise1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h1 id="storage"><a href="#storage" aria-hidden="true" class="header-anchor">#</a> Storage</h1> <h2 id="cookie，localstorage，sessionstorage，indexdb"><a href="#cookie，localstorage，sessionstorage，indexdb" aria-hidden="true" class="header-anchor">#</a> cookie，localStorage，sessionStorage，indexDB</h2> <table><thead><tr><th style="text-align:center">features</th> <th style="text-align:center">cookie</th> <th style="text-align:center">localStorage</th> <th style="text-align:center">sessionStorage</th> <th style="text-align:center">indexDB</th></tr></thead> <tbody><tr><td style="text-align:center">Life cycle of data</td> <td style="text-align:center">generally generated by the server, but you can set the expiration time</td> <td style="text-align:center">unless cleared manually, it always exists</td> <td style="text-align:center">once the browser tab is closed, it will be cleaned up immediately</td> <td style="text-align:center">unless cleared manually, it always exists</td></tr> <tr><td style="text-align:center">Storage size of data</td> <td style="text-align:center">4K</td> <td style="text-align:center">5M</td> <td style="text-align:center">5M</td> <td style="text-align:center">unlimited</td></tr> <tr><td style="text-align:center">Communication with server</td> <td style="text-align:center">it is carried in the header everytime, and has a performance impact on the request</td> <td style="text-align:center">doesn't participate</td> <td style="text-align:center">doesn't participate</td> <td style="text-align:center">doesn't participate</td></tr></tbody></table> <p>As we can see from the above table, <code>cookies</code> are no longer recommended for storage. We can use <code>localStorage</code> and <code>sessionStorage</code> if we don't have much data to store. Use <code>localStorage</code> to store data that doesn't change much, otherwise <code>sessionStorage</code> can be used.</p> <p>For <code>cookies</code>, we also need pay attention to security issue.</p> <table><thead><tr><th style="text-align:center">attribute</th> <th style="text-align:center">effect</th></tr></thead> <tbody><tr><td style="text-align:center">value</td> <td style="text-align:center">the value should be encrypted if used to save the login state, and the cleartext user ID shouldn't be used</td></tr> <tr><td style="text-align:center">http-only</td> <td style="text-align:center">cookies cannot be accessed through JS, for reducing XSS attack</td></tr> <tr><td style="text-align:center">secure</td> <td style="text-align:center">cookies can only be carried in requests with HTTPS protocol</td></tr> <tr><td style="text-align:center">same-site</td> <td style="text-align:center">browsers cannot pass cookies in cross-origin requests, for reducing CSRF attacks</td></tr></tbody></table> <h2 id="service-worker"><a href="#service-worker" aria-hidden="true" class="header-anchor">#</a> Service Worker</h2> <blockquote><p>Service workers essentially act as proxy servers that sit between web applications, the browser and the network (when available). They are intended, among other things, to enable the creation of effective offline experiences, intercept network requests and take appropriate action based on whether the network is available, and update assets residing on the server. They will also allow access to push notifications and background sync APIs.</p></blockquote> <p>At present, this technology is usually used to cache files and increase the render speed of the first screen. We can try to  implement this function:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>serviceWorker
    <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;sw.js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;service worker register success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;servcie worker register error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// sw.js</span>
<span class="token comment">// Listen for the `install` event, and cache the required files in the callback</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;install&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// intercept all the request events</span>
<span class="token comment">// use the cache directly if the requested data already existed in the cache; otherwise, send requests for data</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;fetch&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fetch source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>Open the page, we can see that the Service Worker has started in the <code>Application</code> pane of devTools:</p> <p><img src="https://user-gold-cdn.xitu.io/2018/3/28/1626b1e8eba68e1c?w=1770&h=722&f=png&s=192277" alt></p> <p>In the Cache pane, we can also find that the files we need have been cached:</p> <p><img src="https://user-gold-cdn.xitu.io/2018/3/28/1626b20dfc4fcd26?w=1118&h=728&f=png&s=85610" alt></p> <p>Refreshing the page, we can see that our cached data is read from the Service Worker:</p> <p><img src="https://user-gold-cdn.xitu.io/2018/3/28/1626b20e4f8f3257?w=2818&h=298&f=png&s=74833" alt></p> <h1 id="rendering-mechanism"><a href="#rendering-mechanism" aria-hidden="true" class="header-anchor">#</a> Rendering mechanism</h1> <p>The mechanism of the browser engine usually has the following steps:</p> <ol><li><p>Parse HTML to construct the DOM tree.</p></li> <li><p>Parse CSS to construct the CSSOM tree.</p></li> <li><p>Create the render tree by combining the DOM &amp; CSSOM.</p></li> <li><p>Run layout based on the render tree, then calculate each node's exact coordinates on the screen.</p></li> <li><p>Paint elements by GPU, composite layers and display on the screen.</p></li></ol> <p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b2ab2ec70ac5b?w=900&h=352&f=png&s=49983" alt></p> <p>When building the CSSOM tree, the rendering is blocked until the CSSOM tree is built. And building the CSSOM tree is a very cost-intensive process, so you should try to ensure that the level is flat and reduce excessive cascading. The more specific the CSS selector is, the slower the execution.</p> <p>When the HTML is parsing the script tag, the DOM is paused and will restart from the paused position. In other words, the faster you want to render the first screen, the less you should load the JS file on the first screen. And CSS will also affect the execution of JS. JS will only be executed when the stylesheet is parsed. Therefore, it can be considered that CSS will also suspend the DOM in this case.</p> <p><img src="https://user-gold-cdn.xitu.io/2018/7/8/1647838a3b408372?w=1676&h=688&f=png&s=154480" alt></p> <p><img src="https://user-gold-cdn.xitu.io/2018/7/8/16478388e773b16a?w=1504&h=760&f=png&s=123231" alt></p> <h2 id="difference-between-load-domcontentloaded"><a href="#difference-between-load-domcontentloaded" aria-hidden="true" class="header-anchor">#</a> Difference between Load &amp; DOMContentLoaded</h2> <p><strong>Load</strong> event occurs when all the resources (e.g. DOM、CSS、JS、pictures) have been loaded.</p> <p><strong>DOMContentLoaded</strong> event occurs as soon as the HTML of the pages has been loaded, no matter whether the other resources have been loaded.</p> <h2 id="layers"><a href="#layers" aria-hidden="true" class="header-anchor">#</a> Layers</h2> <p>Generally，we can treat the document flow as a single layer. Some special attributes also could create a new layer. <strong>Different Layers are independent</strong>. So, it is recommended to create a new layer to render some elements which changes frequently. <strong>But it is also a bad idea to create too many layers.</strong></p> <p>The following attributes usually can create a new layer:</p> <ul><li><p>3Dtranslate: <code>translate3d</code>, <code>translateZ</code></p></li> <li><p><code>will-change</code></p></li> <li><p>tags like: <code>video</code>, <code>iframe</code></p></li> <li><p>animation achieved by <code>opacity</code></p></li> <li><p><code>position: fixed</code></p></li></ul> <h2 id="repaint-reflow"><a href="#repaint-reflow" aria-hidden="true" class="header-anchor">#</a> Repaint &amp; Reflow</h2> <p>Repaint and Reflow is a small step in the main rendering flow, but they have a great impact on the performance.</p> <ul><li><p>Repaint occurs when the node changes but doesn't affect the layout, e.g. <code>color</code>.</p></li> <li><p>Reflow occurs when the node changes caused by layout or the geometry attributes.</p></li></ul> <p>Reflow will trigger a Repaint, but the opposite is not necessarily true. Reflow is much more expensive than Repaint. The changes in deep level node's attributes may cause a series of changes of its ancestral nodes.</p> <p>Actions like the following may cause performance problems:</p> <ul><li><p>change the window's size</p></li> <li><p>change font-family</p></li> <li><p>add or delete styles</p></li> <li><p>change texts</p></li> <li><p>change position &amp; float</p></li> <li><p>change box model</p></li></ul> <p>You may not know that Repaint and Reflow has something to do with the <strong>Event Loop</strong>.</p> <ul><li><p>In a event loop, when a microtask finishes, the engine will check whether the document needs update. As the refresh rate of the browse is 60Hz, this means it will update every 16ms.</p></li> <li><p>Then browser would check whether there are events like <code>resize</code> or <code>scroll</code> and if true, trigger the handlers. So the handlers of resize and scroll will be invoked every 16ms, which means automatic throttling.</p></li> <li><p>Evaluate media queries and report changes.</p></li> <li><p>Update animations and send events.</p></li> <li><p>Check whether this is a full-screen event.</p></li> <li><p>Execute <code>requestAnimationFrame</code> callback.</p></li> <li><p>Execute <code>IntersectionObserver</code> callback, which is used to determine whether an element should be displaying, usually in lazy-load, but has poor compatibility.</p></li> <li><p>Update the screen.</p></li> <li><p>The above events may occur in every frame. If there is idle time, the <code>requestIdleCallback</code> callback will be called.</p></li></ul> <p>All of the above are from <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model" target="_blank" rel="noopener noreferrer">HTML Documents<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="minimize-repaint-reflow"><a href="#minimize-repaint-reflow" aria-hidden="true" class="header-anchor">#</a> Minimize Repaint &amp; Reflow</h2> <ul><li>Use <code>translate</code> instead of <code>top</code>:</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
	<span class="token selector">.test</span> <span class="token punctuation">{</span>
		<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
		<span class="token property">top</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
		<span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
		<span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
		<span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// occurs reflow</span>
		document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">'100px'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><p>Use <code>visibility</code> instead of <code>display: none</code>, because the former will only cause Repaint while the latter will cause Reflow, which changes the layout.</p></li> <li><p>Change the DOM when it is offline, e.g. change the DOM 100 times after set it <code>display: none</code> and then show it on screen. During this process there is only one Reflow.</p></li> <li><p>Do not put an attribute of a node inside a loop:</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// it will cause the reflow to get offsetTop, because it need to calculate the right value</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>Do not use table to construct the layout, because even a little change will cause the re-construct.</p></li> <li><p>Animation speed matters: the faster it goes, the more Reflow. You can also utilize <code>requestAnimationFrame</code>.</p></li> <li><p>The css selector will search to match from right to left, so you'd better avoid deep level DOM node.</p></li> <li><p>As we know that the layer will prevent the changed node from affecting others, so it is good practice to create a new layer for animations with high frequency.</p></li></ul> <p><img src="https://user-gold-cdn.xitu.io/2018/3/29/1626fb6f33a6f9d7?w=1588&h=768&f=png&s=263260" alt></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/7/2018, 12:14:38 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/en/front/" class="prev router-link-active">
          JS
        </a></span> <span class="next"><a href="/en/front/Framework/">
          Framework
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/15.36ec339b.js" defer></script><script src="/assets/js/app.242f705e.js" defer></script>
  </body>
</html>
